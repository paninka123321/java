SELECT
    -- kolumny nadrzędne zawsze pokazane
    CASE WHEN :P2_LEVEL >= 0 THEN USŁUGA_LEV1 END AS USŁUGA_LEV1,
    CASE WHEN :P2_LEVEL >= 1 THEN KATEGORIA END AS KATEGORIA,
    CASE WHEN :P2_LEVEL >= 2 THEN PODKATEGORIA END AS PODKATEGORIA,
    
    SUM(VALUE) AS VALUE
FROM DO_SZKOLENIA_DRAZENIE
WHERE
      NVL(:P2_LEVEL,0)=0
   OR (:P2_LEVEL=1 AND USŁUGA_LEV1 = :P2_PREVIOUS_LEVEL)
   OR (:P2_LEVEL=2 AND (USŁUGA_LEV1 || '|' || KATEGORIA) = :P2_PATH)
GROUP BY
    CASE WHEN :P2_LEVEL >= 0 THEN USŁUGA_LEV1 END,
    CASE WHEN :P2_LEVEL >= 1 THEN KATEGORIA END,
    CASE WHEN :P2_LEVEL >= 2 THEN PODKATEGORIA END
ORDER BY 1,2,3;
